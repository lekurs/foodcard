(function($){
    $.fn.card = function (oo){

        var svg = {
            "visa" : "<svg  x=\"0px\" y=\"0px\" width=\"750px\" height=\"471px\" viewBox=\"0 0 750 471\" enable-background=\"new 0 0 750 471\" xml:space=\"preserve\"><g id=\"visa\" sketch:type=\"MSLayerGroup\"><path id=\"Shape\" sketch:type=\"MSShapeGroup\" fill=\"#0E4595\" d=\"M278.198,334.228l33.36-195.763h53.358l-33.384,195.763H278.198L278.198,334.228z\"></path><path id=\"path13\" sketch:type=\"MSShapeGroup\" fill=\"#0E4595\" d=\"M524.307,142.687c-10.57-3.966-27.135-8.222-47.822-8.222c-52.725,0-89.863,26.551-90.18,64.604c-0.297,28.129,26.514,43.821,46.754,53.185c20.77,9.597,27.752,15.716,27.652,24.283c-0.133,13.123-16.586,19.116-31.924,19.116c-21.355,0-32.701-2.967-50.225-10.274l-6.877-3.112l-7.488,43.823c12.463,5.466,35.508,10.199,59.438,10.445c56.09,0,92.502-26.248,92.916-66.884c0.199-22.27-14.016-39.216-44.801-53.188c-18.65-9.056-30.072-15.099-29.951-24.269c0-8.137,9.668-16.838,30.559-16.838c17.447-0.271,30.088,3.534,39.936,7.5l4.781,2.259L524.307,142.687\"></path><path id=\"Path\" sketch:type=\"MSShapeGroup\" fill=\"#0E4595\" d=\"M661.615,138.464h-41.23c-12.773,0-22.332,3.486-27.941,16.234l-79.244,179.402h56.031c0,0,9.16-24.121,11.232-29.418c6.123,0,60.555,0.084,68.336,0.084c1.596,6.854,6.492,29.334,6.492,29.334h49.512L661.615,138.464L661.615,138.464z M596.198,264.872c4.414-11.279,21.26-54.724,21.26-54.724c-0.314,0.521,4.381-11.334,7.074-18.684l3.607,16.878c0,0,10.217,46.729,12.352,56.527h-44.293V264.872L596.198,264.872z\"></path><path id=\"path16\" sketch:type=\"MSShapeGroup\" fill=\"#0E4595\" d=\"M232.903,138.464L180.664,271.96l-5.565-27.129c-9.726-31.274-40.025-65.157-73.898-82.12l47.767,171.204l56.455-0.064l84.004-195.386L232.903,138.464\"></path><path id=\"path18\" sketch:type=\"MSShapeGroup\" fill=\"#F2AE14\" d=\"M131.92,138.464H45.879l-0.682,4.073c66.939,16.204,111.232,55.363,129.618,102.415l-18.709-89.96C152.877,142.596,143.509,138.896,131.92,138.464\"></path></g></svg>",
            "mastercard" : "<svg id=\"Layer_1\" data-name=\"Layer 1\" xmlns=\"http://www.w3.org/2000/svg\" width=\"482.51\" height=\"374\" viewBox=\"0 0 482.51 374\"> <title>mastercard</title> <g> <path d=\"M220.13,421.67V396.82c0-9.53-5.8-15.74-15.32-15.74-5,0-10.35,1.66-14.08,7-2.9-4.56-7-7-13.25-7a14.07,14.07,0,0,0-12,5.8v-5h-7.87v39.76h7.87V398.89c0-7,4.14-10.35,9.94-10.35s9.11,3.73,9.11,10.35v22.78h7.87V398.89c0-7,4.14-10.35,9.94-10.35s9.11,3.73,9.11,10.35v22.78Zm129.22-39.35h-14.5v-12H327v12h-8.28v7H327V408c0,9.11,3.31,14.5,13.25,14.5A23.17,23.17,0,0,0,351,419.6l-2.49-7a13.63,13.63,0,0,1-7.46,2.07c-4.14,0-6.21-2.49-6.21-6.63V389h14.5v-6.63Zm73.72-1.24a12.39,12.39,0,0,0-10.77,5.8v-5h-7.87v39.76h7.87V399.31c0-6.63,3.31-10.77,8.7-10.77a24.24,24.24,0,0,1,5.38.83l2.49-7.46a28,28,0,0,0-5.8-.83Zm-111.41,4.14c-4.14-2.9-9.94-4.14-16.15-4.14-9.94,0-16.15,4.56-16.15,12.43,0,6.63,4.56,10.35,13.25,11.6l4.14.41c4.56.83,7.46,2.49,7.46,4.56,0,2.9-3.31,5-9.53,5a21.84,21.84,0,0,1-13.25-4.14l-4.14,6.21c5.8,4.14,12.84,5,17,5,11.6,0,17.81-5.38,17.81-12.84,0-7-5-10.35-13.67-11.6l-4.14-.41c-3.73-.41-7-1.66-7-4.14,0-2.9,3.31-5,7.87-5,5,0,9.94,2.07,12.43,3.31Zm120.11,16.57c0,12,7.87,20.71,20.71,20.71,5.8,0,9.94-1.24,14.08-4.56l-4.14-6.21a16.74,16.74,0,0,1-10.35,3.73c-7,0-12.43-5.38-12.43-13.25S445,389,452.07,389a16.74,16.74,0,0,1,10.35,3.73l4.14-6.21c-4.14-3.31-8.28-4.56-14.08-4.56-12.43-.83-20.71,7.87-20.71,19.88h0Zm-55.5-20.71c-11.6,0-19.47,8.28-19.47,20.71s8.28,20.71,20.29,20.71a25.33,25.33,0,0,0,16.15-5.38l-4.14-5.8a19.79,19.79,0,0,1-11.6,4.14c-5.38,0-11.18-3.31-12-10.35h29.41v-3.31c0-12.43-7.46-20.71-18.64-20.71h0Zm-.41,7.46c5.8,0,9.94,3.73,10.35,9.94H364.68c1.24-5.8,5-9.94,11.18-9.94ZM268.59,401.79V381.91h-7.87v5c-2.9-3.73-7-5.8-12.84-5.8-11.18,0-19.47,8.7-19.47,20.71s8.28,20.71,19.47,20.71c5.8,0,9.94-2.07,12.84-5.8v5h7.87V401.79Zm-31.89,0c0-7.46,4.56-13.25,12.43-13.25,7.46,0,12,5.8,12,13.25,0,7.87-5,13.25-12,13.25-7.87.41-12.43-5.8-12.43-13.25Zm306.08-20.71a12.39,12.39,0,0,0-10.77,5.8v-5h-7.87v39.76H532V399.31c0-6.63,3.31-10.77,8.7-10.77a24.24,24.24,0,0,1,5.38.83l2.49-7.46a28,28,0,0,0-5.8-.83Zm-30.65,20.71V381.91h-7.87v5c-2.9-3.73-7-5.8-12.84-5.8-11.18,0-19.47,8.7-19.47,20.71s8.28,20.71,19.47,20.71c5.8,0,9.94-2.07,12.84-5.8v5h7.87V401.79Zm-31.89,0c0-7.46,4.56-13.25,12.43-13.25,7.46,0,12,5.8,12,13.25,0,7.87-5,13.25-12,13.25-7.87.41-12.43-5.8-12.43-13.25Zm111.83,0V366.17h-7.87v20.71c-2.9-3.73-7-5.8-12.84-5.8-11.18,0-19.47,8.7-19.47,20.71s8.28,20.71,19.47,20.71c5.8,0,9.94-2.07,12.84-5.8v5h7.87V401.79Zm-31.89,0c0-7.46,4.56-13.25,12.43-13.25,7.46,0,12,5.8,12,13.25,0,7.87-5,13.25-12,13.25C564.73,415.46,560.17,409.25,560.17,401.79Z\" transform=\"translate(-132.74 -48.5)\"/> <g> <rect x=\"169.81\" y=\"31.89\" width=\"143.72\" height=\"234.42\" fill=\"#ff5f00\"/> <path d=\"M317.05,197.6A149.5,149.5,0,0,1,373.79,80.39a149.1,149.1,0,1,0,0,234.42A149.5,149.5,0,0,1,317.05,197.6Z\" transform=\"translate(-132.74 -48.5)\" fill=\"#eb001b\"/> <path d=\"M615.26,197.6a148.95,148.95,0,0,1-241,117.21,149.43,149.43,0,0,0,0-234.42,148.95,148.95,0,0,1,241,117.21Z\" transform=\"translate(-132.74 -48.5)\" fill=\"#f79e1b\"/> </g> </g></svg>",
            "cb" : "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"2500\" height=\"2500\" viewBox=\"0 0 192.756 192.756\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" fill=\"#26c6da\" d=\"M0 0h192.756v192.756H0V0z\"/><path fill=\"#fff\" d=\"M176.641 161.9a7.012 7.012 0 0 0 4.986-2.055v-.012a7.033 7.033 0 0 0 2.066-4.986h6.229a13.25 13.25 0 0 1-3.891 9.391v-.012a13.249 13.249 0 0 1-9.391 3.902V161.9h.001z\"/><path fill=\"#fff\" d=\"M183.693 154.848V37.911h6.229v116.937h-6.229z\"/><path fill=\"#fff\" d=\"M183.693 37.911a7.046 7.046 0 0 0-2.064-5v.012a7.036 7.036 0 0 0-4.988-2.065V24.63c3.666 0 6.986 1.487 9.391 3.891v.012a13.236 13.236 0 0 1 3.891 9.38h-6.23v-.002zM176.641 30.856H16.117v-6.228h160.524v6.228zM16.117 30.856c-1.948 0-3.713.791-4.988 2.065s-2.065 3.04-2.065 4.989h-6.23c0-3.667 1.488-6.988 3.891-9.392s5.725-3.891 9.391-3.891v6.229h.001zM9.063 37.911v116.937H2.834V37.911h6.229z\"/><path fill=\"#fff\" d=\"M9.063 154.848c0 1.947.79 3.711 2.065 4.986s3.04 2.066 4.988 2.066v6.229a13.244 13.244 0 0 1-9.391-3.891 13.249 13.249 0 0 1-3.891-9.391h6.229v.001zM16.117 161.9h160.524v6.229H16.117V161.9z\"/><path fill=\"#fff\" d=\"M175.988 66.07c0-8.688-7.037-15.734-15.723-15.748v-.003H102.96v31.517h57.305v-.017c8.686-.015 15.723-7.061 15.723-15.749zM175.988 99.496c0-8.688-7.037-15.733-15.723-15.748v-.002H102.96v31.518h57.305v-.02c8.686-.014 15.723-7.058 15.723-15.748zM59.781 83.746v-1.91h42.076V79.18c0-15.824-12.826-28.651-28.65-28.651h-26.74c-15.824 0-28.653 12.827-28.653 28.651v7.641c0 15.823 12.829 28.651 28.653 28.651h26.74c15.824 0 28.65-12.828 28.65-28.651v-3.075H59.781zM33 142.064c-1.67 3.613-4.115 5.398-7.426 5.398-4.702 0-8.353-3.883-8.353-8.869 0-4.949 3.682-8.904 8.26-8.904 3.373 0 6.312 2.166 7.519 5.535h-2.29c-1.175-2.234-3.155-3.576-5.259-3.576-3.527 0-6.281 3.027-6.281 6.912 0 3.883 2.723 6.945 6.188 6.945 2.228 0 3.774-.998 5.352-3.441H33zM35.152 135.361c.216-3.951 3.27-5.65 7.508-5.65 3.27 0 6.826.914 6.826 5.422v8.945c0 .787.431 1.242 1.329 1.242.251 0 .539-.066.718-.129v1.729a6.801 6.801 0 0 1-1.474.133c-2.299 0-2.658-1.176-2.658-2.939h-.071c-1.58 2.188-3.197 3.428-6.753 3.428-3.412 0-6.213-1.535-6.213-4.93 0-4.736 5.064-4.9 9.949-5.422 1.868-.195 2.91-.424 2.91-2.285 0-2.777-2.192-3.461-4.851-3.461-2.801 0-4.885 1.174-4.956 3.918h-2.264v-.001zm12.07 2.481h-.072c-.288.492-1.293.652-1.903.75-3.844.623-8.622.59-8.622 3.887 0 2.059 2.012 3.334 4.132 3.334 3.449 0 6.501-1.994 6.466-5.293v-2.678h-.001zM53.192 130.104h2.166v2.441c.699-1.285 2.369-2.377 4.986-2.545v1.994c-1.479.137-2.167.379-3.094 1.17-1.307 1.062-1.754 2.131-1.754 4.021v9.867h-2.304v-16.948zM101.631 127.18h2.303v5.846c1.479-2.199 3.746-3.336 6.635-3.336 4.918 0 9.008 3.988 9.008 8.801 0 4.951-4.021 8.973-8.973 8.973-2.854 0-5.293-1.201-6.807-3.334v2.924h-2.166V127.18zm2.131 11.517c0 3.781 3.061 6.809 6.877 6.809 3.746 0 6.771-3.129 6.771-6.945 0-3.852-2.992-6.912-6.703-6.912-4.057-.001-6.945 2.958-6.945 7.048zM120.582 127.18h2.166v19.873h-2.166V127.18zM126.338 139.385c.172 3.369 3.162 6.121 6.633 6.121 2.441 0 4.986-1.723 5.879-3.988h2.373c-1.203 3.471-4.641 5.945-8.252 5.945-4.949 0-8.902-3.918-8.902-8.869 0-4.949 3.92-8.904 8.834-8.904 3.232 0 6.223 1.824 7.77 4.711.723 1.34.996 2.613 1.064 4.984h-15.399zm13.096-1.961c-.822-3.504-3.367-5.775-6.463-5.775-3.264 0-5.98 2.373-6.564 5.775h13.027zM160.814 139.385c.172 3.369 3.162 6.121 6.635 6.121 2.441 0 4.982-1.723 5.877-3.988h2.375c-1.205 3.471-4.645 5.945-8.252 5.945-4.951 0-8.904-3.918-8.904-8.869 0-4.949 3.92-8.904 8.836-8.904 3.23 0 6.221 1.824 7.768 4.711.725 1.34.998 2.613 1.066 4.984h-15.401zm13.098-1.961c-.826-3.504-3.369-5.775-6.463-5.775-3.266 0-5.982 2.373-6.566 5.775h13.029zM71.825 139.385c.172 3.369 3.163 6.121 6.634 6.121 2.441 0 4.985-1.723 5.879-3.988h2.372c-1.203 3.471-4.64 5.945-8.251 5.945-4.949 0-8.902-3.918-8.902-8.869 0-4.949 3.919-8.904 8.835-8.904 3.231 0 6.222 1.824 7.77 4.711.722 1.34.996 2.613 1.065 4.984H71.825zm13.097-1.961c-.824-3.504-3.368-5.775-6.463-5.775-3.265 0-5.981 2.373-6.565 5.775h13.028z\" fill-rule=\"evenodd\" clip-rule=\"evenodd\"/><path fill=\"#fff\" d=\"M64.383 130.043h5.898v1.922h-5.898v10.668c0 1.486.218 2.355 1.851 2.465.654 0 3.395-.035 4.047-.109v1.961c-.689 0-3.43.072-4.12.072-3.049 0-4.101-1.016-4.064-4.207v-10.85h-.576v-1.922h.576v-2.863h2.286v2.863zM155.262 130.158v9.352c0 3.764-1.945 6.029-5.217 6.049-3.275-.02-5.217-2.285-5.217-6.049v-9.352h-2.166v9.352c0 5.088 2.578 8.012 7.08 8.012.105 0 .199-.014.303-.018.102.004.195.018.301.018 4.502 0 7.08-2.924 7.08-8.012v-9.352h-2.164z\" fill-rule=\"evenodd\" clip-rule=\"evenodd\"/></svg>",
            "card" : "<svg version=\"1.1\" id=\"cardfront\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 750 471\" style=\"enable-background:new 0 0 750 471;\" xml:space=\"preserve\"><g id=\"Front\"><g id=\"CardBackground\"><g id=\"Page-1_1_\"><g id=\"amex_1_\"><path id=\"Rectangle-1_1_\" class=\"lightcolor {{cardcolor}}\" d=\"M40,0h670c22.1,0,40,17.9,40,40v391c0,22.1-17.9,40-40,40H40c-22.1,0-40-17.9-40-40V40C0,17.9,17.9,0,40,0z\"></path></g></g><path class=\"darkcolor {{cardcolor}}dark\" d=\"M750,431V193.2c-217.6-57.5-556.4-13.5-750,24.9V431c0,22.1,17.9,40,40,40h670C732.1,471,750,453.1,750,431z\"></path></g><text transform=\"matrix(1 0 0 1 60.106 295.0121)\" id=\"svgnumber\" class=\"st2 st3 st4\">{{cardnumber}}</text><text transform=\"matrix(1 0 0 1 54.1064 428.1723)\" id=\"svgname\" class=\"st2 st5 st6\">{{cardname}}</text><text transform=\"matrix(1 0 0 1 54.1074 389.8793)\" class=\"st7 st5 st8\">cardholder name</text><text transform=\"matrix(1 0 0 1 479.7754 388.8793)\" class=\"st7 st5 st8\">expiration</text><text transform=\"matrix(1 0 0 1 65.1054 241.5)\" class=\"st7 st5 st8\">card number</text><g><text transform=\"matrix(1 0 0 1 574.4219 433.8095)\" id=\"svgexpire\" class=\"st2 st5 st9\">{{carddate}}</text><text transform=\"matrix(1 0 0 1 479.3848 417.0097)\" class=\"st2 st10 st11\">VALID</text><text transform=\"matrix(1 0 0 1 479.3848 435.6762)\" class=\"st2 st10 st11\">THRU</text><polygon class=\"st2\" points=\"554.5,421 540.4,414.2 540.4,427.9\"></polygon></g><g id=\"cchip\"><g><path class=\"st2\" d=\"M168.1,143.6H82.9c-10.2,0-18.5-8.3-18.5-18.5V74.9c0-10.2,8.3-18.5,18.5-18.5h85.3c10.2,0,18.5,8.3,18.5,18.5v50.2C186.6,135.3,178.3,143.6,168.1,143.6z\"></path></g><g><g><rect x=\"82\" y=\"70\" class=\"st12\" width=\"1.5\" height=\"60\"></rect></g><g><rect x=\"167.4\" y=\"70\" class=\"st12\" width=\"1.5\" height=\"60\"></rect></g><g><path class=\"st12\" d=\"M125.5,130.8c-10.2,0-18.5-8.3-18.5-18.5c0-4.6,1.7-8.9,4.7-12.3c-3-3.4-4.7-7.7-4.7-12.3c0-10.2,8.3-18.5,18.5-18.5s18.5,8.3,18.5,18.5c0,4.6-1.7,8.9-4.7,12.3c3,3.4,4.7,7.7,4.7,12.3C143.9,122.5,135.7,130.8,125.5,130.8z M125.5,70.8c-9.3,0-16.9,7.6-16.9,16.9c0,4.4,1.7,8.6,4.8,11.8l0.5,0.5l-0.5,0.5c-3.1,3.2-4.8,7.4-4.8,11.8c0,9.3,7.6,16.9,16.9,16.9s16.9-7.6,16.9-16.9c0-4.4-1.7-8.6-4.8-11.8l-0.5-0.5l0.5-0.5c3.1-3.2,4.8-7.4,4.8-11.8C142.4,78.4,134.8,70.8,125.5,70.8z\"></path></g><g><rect x=\"82.8\" y=\"82.1\" class=\"st12\" width=\"25.8\" height=\"1.5\"></rect></g><g><rect x=\"82.8\" y=\"117.9\" class=\"st12\" width=\"26.1\" height=\"1.5\"></rect></g><g><rect x=\"142.4\" y=\"82.1\" class=\"st12\" width=\"25.8\" height=\"1.5\"></rect></g><g><rect x=\"142\" y=\"117.9\" class=\"st12\" width=\"26.2\" height=\"1.5\"></rect></g></g></g></g></svg>"
        };

        this.each(function () {
            var elt;
            var ccsingleSVG = "";
            var options = {
                name : "John Doe",
                date : null,
                number : "**** **** **** ****",
                type : "visa",
                default: "true",
                pm : ""
            };
            var card = {
                OptionsInit:function(){
                    //la carte
                    if(typeof $(elt).data("card") !== "undefined"){
                        options.number += " "+$(elt).data("card");
                    }
                    else{
                        options.number += " ****";
                    }
                    $.each($(elt).data(), function(i, v){
                        if(v !== '')
                        {
                            options[i] = v;
                        }
                        //on supprime l'attribut
                        // $(elt).removeAttr("data-"+i);

                    });

                },
                Init:function(){
                    $(elt).addClass("creditcard");
                    svgTxt = this.Customize(svg.card);


                    let font = $("<div>").addClass("front").html(svgTxt);
                    let ccsingle = $("<div>").attr("id", "ccsingle").html(ccsingleSVG);
                    if(options.default !== true){
                        let overlay = $("<div>").addClass("card-overlay");
                        $(elt).append(overlay);
                        let btnfav = $("<a>").attr("href", "/admin-client/compte/paiement/definir/"+ options.pm).addClass("card_pm_link").html("En faire ma carte principale");
                        $(elt).append(btnfav);
                    }
                    let btndel = $("<a>").attr("href", "/admin-client/compte/paiement/delete/"+ options.pm).addClass("card_pm_del").html("<i class=\"fas fa-times\"></i>");
                    $(elt).append(btndel);
                    font.prepend(ccsingle);
                    $(elt).append(font);
                },
                Customize:function(svgTxt){
                    svgTxt = svgTxt.replace("{{cardname}}", options.name);
                    svgTxt = svgTxt.replace("{{cardnumber}}", options.number);
                    svgTxt =svgTxt.replace("{{carddate}}", options.date);

                    switch (options.type) {
                        case "visa" : color = "lightblue";
                            ccsingleSVG = svg.visa;
                            break;
                        case "mastercard" : color = "green";
                            ccsingleSVG = svg.mastercard;
                            break;
                        default : color = "cyan";
                            ccsingleSVG = svg.cb;
                    }

                    svgTxt =svgTxt.replaceAll("{{cardcolor}}", color);

                    return svgTxt;
                }
            };


            //perenisation de l'élément current
            elt = this;

            //les options
            card.OptionsInit();

            //on lance la manipulation du DOM
            card.Init();
        });
    }
})(jQuery);
